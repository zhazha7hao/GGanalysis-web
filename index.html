<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>抽卡概率计算器 (Gacha Calculator)</title>
    <link rel="stylesheet" href="styles.css">
    <script src="js/libs/chart.js"></script>
</head>

<body>
    <div class="app-container">
        <header>
            <h1>抽卡概率计算器</h1>
            <nav>
                <button type="button" class="nav-btn active" data-game="genshin">原神 (Genshin)</button>
                <button type="button" class="nav-btn" data-game="hsr">星穹铁道 (HSR)</button>
                <button type="button" class="nav-btn" data-game="zzz">绝区零 (ZZZ)</button>
                <button type="button" class="nav-btn" data-game="wuthering_waves">鸣潮 (Waves)</button>
                <button type="button" class="nav-btn" data-game="arknights">明日方舟 (Arknights)</button>
                <button type="button" class="nav-btn" data-game="reverse_1999">重返未来1999 (Reverse 1999)</button>
            </nav>
        </header>

        <main>
            <section class="controls">
                <div class="card">
                    <h2>参数配置</h2>
                    <p class="hint">输入 0 表示不计算该项。</p>

                    <!-- Global Controls -->
                    <div class="controls-row"
                        style="margin-bottom: 15px; display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 10px;">
                        <label class="toggle-switch">
                            <input type="checkbox" id="auto-calc" checked>
                            <span class="slider"></span>
                            <span style="white-space: nowrap;">自动计算 (Auto Calc)</span>
                        </label>
                        <button type="button" id="calc-btn" class="action-btn">计算 (Calculate)</button>
                    </div>

                    <form id="calc-form">

                        <!-- Game Mode Selector (Dynamic) -->
                        <div class="form-group" id="mode-selection" style="display:none;">
                            <label for="game-mode">计算模式 (Mode)</label>
                            <select id="game-mode"></select>
                        </div>

                        <!-- Arknights Specific Inputs -->
                        <div class="input-section" id="ak-extras" style="display:none;">
                            <h3>高级选项 (Advanced)</h3>
                            <div class="form-group">
                                <label for="ak-type-pity">定向/类型保底计数 (Type Pity)</label>
                                <div class="input-row">
                                    <input type="number" id="ak-type-pity" value="0" min="0" max="200">
                                    <input type="range" id="ak-type-pity-slider" min="0" max="200" value="0">
                                </div>
                                <p class="hint">距离上次触发定向/类型保底已垫的抽数 (Standard 150/Rotation 200)</p>
                            </div>
                        </div>

                        <!-- 角色参数 -->
                        <div class="input-section" id="char-section">
                            <h3 id="char-label">角色池 (Character)</h3>
                            <div class="form-group">
                                <label for="char-item-num">目标数量 (个)</label>
                                <div class="slider-container">
                                    <input type="range" id="char-item-slider" min="0" max="7" value="1">
                                    <input type="number" id="char-item-num" value="1" min="0" max="7">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="char-pity">当前已垫抽数</label>
                                <input type="number" id="char-pity" value="0" min="0" max="89">
                            </div>
                            <div class="form-group" id="char-guaranteed-box">
                                <label>是否有大保底?</label>
                                <div class="radio-group">
                                    <label>
                                        <input type="radio" name="char-guaranteed" value="0" checked>
                                        否
                                    </label>
                                    <label>
                                        <input type="radio" name="char-guaranteed" value="1">
                                        是
                                    </label>
                                </div>
                            </div>
                        </div>

                        <hr class="separator">

                        <!-- 武器参数 -->
                        <div class="input-section">
                            <h3 id="weapon-label">武器池 (Weapon)</h3>
                            <div class="form-group">
                                <label for="weapon-item-num">目标数量 (个)</label>
                                <div class="slider-container">
                                    <input type="range" id="weapon-item-slider" min="0" max="5" value="0">
                                    <input type="number" id="weapon-item-num" value="0" min="0" max="5">
                                </div>
                                <span class="hint">0 = 不抽, 1 = 1精, 5 = 5精</span>
                            </div>
                            <div class="form-group">
                                <label for="weapon-pity">当前已垫抽数</label>
                                <input type="number" id="weapon-pity" value="0" min="0" max="79">
                            </div>
                            <div class="form-group" id="weapon-guaranteed-box">
                                <label>是否有大保底?</label>
                                <div class="radio-group">
                                    <label>
                                        <input type="radio" name="weapon-guaranteed" value="0" checked>
                                        否
                                    </label>
                                    <label>
                                        <input type="radio" name="weapon-guaranteed" value="1">
                                        是
                                    </label>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn-primary" style="display:none;">开始计算 (Calculate)</button>
                    </form>
                </div>
            </section>

            <section class="visualization">
                <div class="card results">
                    <h2>计算结果 (需抽数)</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="label">期望 (Expectation)</span>
                            <span class="value" id="res-exp">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="label">方差 (Variance)</span>
                            <span class="value" id="res-var">-</span>
                        </div>
                    </div>
                </div>

                <div class="card full-width">
                    <h2>概率分布图 (Probability Distribution)</h2>
                    <canvas id="prob-chart"></canvas>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="js/logic/distribution.js"></script>
    <script src="js/logic/layer.js"></script>
    <script src="js/logic/model.js"></script>
    <script src="js/logic/games/genshin.js"></script>
    <script src="js/logic/games/hsr.js"></script>
    <script src="js/logic/games/zzz.js"></script>
    <script src="js/logic/games/wuthering_waves.js"></script>
    <script src="js/logic/games/arknights.js"></script>
    <script src="js/logic/games/reverse_1999.js"></script>
    <script src="js/ui/charts.js"></script>
    <script src="js/ui/main.js"></script>
</body>

</html>